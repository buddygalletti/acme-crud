<html>
  <head>
<style>
    #nav {
        padding: 2em;
    }
    a {
        padding-right: 20px;
    }
    .admin {
        background-color: dodgerblue;
    }
    .users > div {
        padding: 10px;
    }
    .admin > a {
        color: white;
    }
</style>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.js'></script>
  <script>
      function DB(key){
        this.key = key;
      }

      DB.prototype = {
        delay: () => {
          return new Promise((res)=> {
            setTimeout(()=> {
              res();
            }, Math.random()*100)
          });
        },
        storage: window.localStorage,
        byId: function(id){
          return this.read()
            .then( items => items.find( item => item.id === id)); 
        },
        read: function(){
          return new Promise((resolve, reject)=> {
            const data = this.storage.getItem(this.key);
            if(!data){
              return this.delay().then(()=> resolve([]));
            }
            try{
              const parsed = JSON.parse(data);
              if(!Array.isArray(parsed)){
                return resolve([]);
              }
              this.delay().then(()=> resolve(parsed));
            }
            catch(ex){
              resolve([]);
            }
          });
        },
        create: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const id = Math.random().toString().slice(2);
                const _item = Object.assign({}, item, { id });
                items.push(_item)
                this.storage.setItem(this.key, JSON.stringify(items))
                this.delay().then(() => resolve(_item));
              });
          });
        },
        update: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const _items = items.map(_item => {
                  if(_item.id === item.id){
                    return item;
                  }
                  return _item;
                });
                this.storage.setItem(this.key, JSON.stringify(_items));
                this.delay().then(()=> resolve(item));
              });
          });
        },
        clear: function(){
          return new Promise((resolve, reject)=> {
            this.storage.removeItem(this.key);
            resolve();

          });

        },
        destroy: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const _items = items.filter(_item => {
                  return _item.id !== item.id;
                });
                this.storage.setItem(this.key, JSON.stringify(_items));
                resolve();
              });
          });
        },
      };
  </script>
  </head>
  <body>
    <div id='root'></div>
    <script type='text/babel'>
      const { HashRouter, Route, Link, NavLink } = ReactRouterDOM;
      const root = document.querySelector('#root');
      const db = new DB('users');
      
      const Nav = ({ users }) => {
          const numAdmins = users.reduce(function(acc, user){
              if(user.admin){
                  return acc + 1;
              }
              return acc;
          }, 0)
          return (
              <div id='nav'>
                <Link to='/home'>Home</Link>
                <Link to='/users'>Users: ({ users.length }) Admins: ({ numAdmins })</Link>
              </div>
          )
      }
      
      const Users = ({ users }) => {
        return (
            <div className='users'>
                {
                    users.map(user => {
                        return (
                            <div key={user.id} className={user.admin ? 'admin' : ''}>
                                <Link to={`/users/${user.id}`}>{user.name}</Link>
                            </div>
                        )
                    })
                }       
            </div>
        )
      }
      
      class App extends React.Component{
        constructor(){
          super();
          this.state = {
            users: [
                {name: 'buddy', id: 1, admin: true},
                {name: 'hannah', id: 2, admin: false},
                {name: 'sam', id: 3, admin: false}
            ],
          }
        }

        componentDidMount(){
        //   db.read()
        //     .then(users => this.setState({ users }))
        }
        render(){
          const { users, admins } = this.state;
          const { totalNumUsers } = this;
          return(
              <HashRouter>
                <Route path='/' render={() => <Nav users={ users } />} />
                <Route path='/users' render={() => <Users users={ users } />} />
              </HashRouter>
          );
        }
      }


      ReactDOM.render(<App />, root);
    </script>
  </body>
</html>